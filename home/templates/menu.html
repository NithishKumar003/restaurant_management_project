{% load static %}
{% load tz %}

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>{{ restaurant_name }}</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body style="font-family: 'Segoe UI', sans-serif; background-color: #f9f9f9; color: #333; margin: 0; padding: 0;">
    <div style="text-align: center; margin-top: 20px;">
        {% if restaurant.logo %}
            <img src="{{ restaurant.logo.url }}" alt="{{ restaurant.name }} logo"
                style="width: 150px; height: auto; border-radius: 10px;">
        {% else %}
            <p style="color: gray;">[No logo uploded]</p>
        {% endif %}
    </div>

    <nav style="background-color: #f8f8f8; padding: 10px;">
        <a href="/" style="margin-right: 15px;">Home</a>
        <a href="{% url 'about' %}">About</a>
        <a href="{% url 'contact' %}">Contact</a>
        <a href="{% url 'faq' %}">FAQ</a>
    </nav>

    <a href="{% url 'add_to_cart' item.id %}" style="display: inline-block; margin-top: 10px; padding:8px 15px; background-color: #28a745; color: white; text-decoration: none; border-radius: 5px">
        Add to cart 
    </a>

    <h1 style="text-align: center; background-color: #b91c1c; color: white; padding: 20px; margin: 0;">
        Welcome to {{ restaurant_name }}
    </h1>
    <!-- Opening hours -->
    <div class="opening-hours">
        <h2>Opening Hours</h2>
        <ul>
            {% for day, hours in restaurant.opening_hours.items %}
                <li><strong>{{ day }}:</strong> {{ hours }}</li>
            {% endfor %}
        </ul>
    </div>

    <!-- Address and map  -->
    <section style="max-width: 800px; margin: 40px auto; padding: 0 20px">
        <h2 style="color: #b91c1c;">Our Addresses </h2>
        <p style="margin-bottom: 20px;">{{ restaurant_address }}</p>
        <p style="font-size: 18px; color: #555;">
            Call us : <strong>{{ restaurant_phone }} </strong>
        </p>
        <iframe
            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d387190.2799144891!2d-74.2598673!3d40.697601!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2zNDDCsDQxJzUxLjYiTiA3NMKWMTUnMjAuOCJX!5e0!3m2!1sen!2sin!4v1597078453734!5m2!1sen!2sin"
            width="400"
            height="300"
            style="border:0;"
            allowfullscreen=""
            loading="lazy">
        </iframe>
    </section>

    <section>
        <form method="GET" action="" style="margin-bottom: 20px;">
            <input type="text" name="q" placeholder="Search menu items..."
                value="{{ search_query }}" style="padding: 8px; width: 250px; border-radius: 5px; border: 1px solid #ccc;">
            <button type="submit" style="padding: 8px 15px; border: none; background-color: #ff6600; color:white; border-radius: 5px; cursor: pointer;"> Search </button>
        </form>
    </section>

     <!-- Menu  -->
    <<section style="max-width: 1100px; margin: 40px auto; padding: 0 20px;"> 
        <h2 style="color: #b91c1c">Menu</h2>
        <div id="menu-list" style="display: grid; grid-template-columns: 1fr 1fr; gap:20px;" class="menu-list">
            {% for item in menu_items %}
                <div style="background-color: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1)" class="menu-item">
                   
                    {% if item.image %}
                        <img src="{{ item.image.url }}" alt="{{ item.name }}" style="width: 100%; height: 200px; object-fit: cover; border-radius: 8px;">
                    {% else %}
                        <img src="{{ static 'images/placeholder.png' }}" alt="No Image" style="width: 100px; height: 200px; object-fit: cover; border-radius: 8px;">
                    {% endif %}
                    <div style="padding: 14px 16px 18px;">
                        <h3 style="margin: 0 0 10px;">{{ item.name }}</h3>
                        <p style="margin: 0 0 10px;">{{ item.description }}</p>
                        <strong style="color: #e63946"> Rs.{{ item.price }}</strong>
                    </div>
                </div>
            {% empty %}
                <p> No menu items available.</p>
            {% endfor %}
        </div>
    </section>>

    <!-- Dynamic menu loader -->
    <script>
        const existingNames = Array.from(document.querySelectorAll('#menu-list h3'))
            .map(el => el.innerText.trim());

        fetch("{% url 'menu_api' %}")
            .then(response => response.json())
            .then(data => {
                let menuList = document.getElementById('menu-list');
                data.forEach(item => {
                    // Avoid adding duplicates
                    if (!existingNames.includes(item.name)){
                        let div = document.createElement('div');
                        div.style.cssText = "background-color: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1)";

                        let imgSrc = item.image ? item.image : "{% static 'images/placeholder.png' %}";
                        div.innerHTML = `
                            <img src="${imgSrc}" alt="${item.name}" style="width: 100%; height: 200px; object-fit: cover; border-radius: 8px;">
                            <h3 style="margin: 0 0 10px;">${item.name}</h3>
                            <p style="margin: 0 0 10px;">${item.description}</p>
                            <strong style="color: #e63946">Rs. ${item.price}</strong>
                        `;
                        menuList.appendChild(div);
                    }
                });
            })
            .catch(error => console.error("Error fetching Api Data:", error));
    </script>

    <!-- Contact form -->
    <section style="max-width: 800px; margin: 40px auto; padding: 0 20px;">
        <h2 style="color: #b91c1c"> Contact Us </h2>
        <form method="post" style="background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit" style="background-color: #b91c1c; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">
                Submit
            </button>
        </form>
    </section>

    <footer>
        {% now "Y" as current_year %}
        {% include 'footer.html' with current_year=current_year restaurant_name=restaurant_name opening_hours=opening_hours %}
    </footer>
</body>
</html>